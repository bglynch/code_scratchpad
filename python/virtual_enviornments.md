# Virtual Environments

## pyenv

Manage different versions of python



## virtualenv

### Install

```bash
pip install virtualenv
```

### Start a Project

```bash
cd my_project/
```

---

## johnnydep

Pretty-print a dependency tree for a Python distribution

Example

> ```
> pip install johnnydep
> ```
>
> ```bash
> $ johnnydep boto3
> name                                     summary
> ---------------------------------------  -------------------------------------------------
> boto3                                    The AWS SDK for Python
> ├── botocore<1.11.0,>=1.10.77            Low-level, data-driven core of boto 3.
> │   ├── docutils>=0.10                   Docutils -- Python Documentation Utilities
> │   ├── jmespath<1.0.0,>=0.7.1           JSON Matching Expressions
> │   └── python-dateutil<3.0.0,>=2.1      Extensions to the standard Python datetime module
> │       └── six>=1.5                     Python 2 and 3 compatibility utilities
> ├── jmespath<1.0.0,>=0.7.1               JSON Matching Expressions
> └── s3transfer<0.2.0,>=0.1.10            An Amazon S3 Transfer Manager
>     └── botocore<2.0.0,>=1.3.0           Low-level, data-driven core of boto 3.
>         ├── docutils>=0.10               Docutils -- Python Documentation Utilities
>         ├── jmespath<1.0.0,>=0.7.1       JSON Matching Expressions
>         └── python-dateutil<3.0.0,>=2.1  Extensions to the standard Python datetime module
>             └── six>=1.5                 Python 2 and 3 compatibility utilities
> ```
>
> ```bash
> $ johnnydep ipython --output-format pinned
> ipython==6.5.0
> appnope==0.1.0
> backcall==0.1.0
> decorator==4.3.0
> jedi==0.12.1
> pexpect==4.6.0
> pickleshare==0.7.4
> prompt-toolkit==1.0.15
> pygments==2.2.0
> setuptools==40.0.0
> simplegeneric==0.8.1
> traitlets==4.3.2
> parso==0.3.1
> ptyprocess==0.6.0
> six==1.11.0
> wcwidth==0.1.7
> ipython-genutils==0.2.0
> ```



---

## pip-compile

A set of command line tools to help you keep your pip-based packages fresh, even when you’ve pinned them.

> ```bash
> # requirements.in
> django
> ```
>
> ```bash
> $ pip-compile requirements.in --output-file=requirements.txt
> #
> # This file is autogenerated by pip-compile
> # To update, run:
> #
> #    pip-compile requirements.in
> #
> asgiref==3.2.3
>     # via django
> django==3.0.3
>     # via -r requirements.in
> pytz==2019.3
>     # via django
> sqlparse==0.3.0
>     # via django
> ```



---

## poetry

```bash
pip install poetry
```

###### Create toml file

> ```bash
> poetry init
> ```

###### Create virtual enviornment

> ```bash
> poetry install
> ```

###### Info about the virtaul enviornment

> ```bash
> poetry env info
> 
> poetry env info -p  # -p shows path only
> ```

###### Update poetry to create virtual envs inside the project

> ```
> poetry config virtualenvs.in-project true
> ```

###### Enter virtual enviornment

> ```
> poetry shell
> ```

###### Add dependencies

> ```bash
> poetry add requests
> ```

###### Remove dependencies

> ```
> poetry remove requests
> ```









---

## Pipenv

Before piping, pip was used for package management and virtualenv was used for virtual environments.

Pipenv combines these.

### Install

```bash
pip install pipenv
```



### Start a Project

```bash
mkdir my_project            # create a new project
cd my_project/              # enter the project
pipenv install requests     # use pipenv to install the requests library

tree
.
├── Pipfile           # Pipfile created,
└── Pipfile.lock      # Pipfile.lock created, 
```

#### Pipfile

Uses toml format. Is an editable file.

```toml
[[source]]
url = "https://pypi.org/simple"
verify_ssl = true
name = "pypi"

[packages]
requests = "*"      # "*" as no version selected, can be modified

[dev-packages]

[requires]
python_version = "3.8"
```

#### Pipfile.lock

Generated file that has more detail about the current environment.
Contains package and dependencies of libraries installed.
Don't manually modify this file.

#### Activate Enviornment

```
pipenv shell
```

Can see what python is being used now that we are in the pipenv shell

```python
python
>>> import sys
>>> sys.executable
'/Users/brianlynch/.local/share/virtualenvs/my_project-HsV6LrWY/bin/python'
```

#### Deactivate Enviornment

```
exit
```

#### Run command without activating the Enviornment

```bash
pipenv run python              # run python using the virtual enviornment
pipenv run python script.py    # run python script using the virtual enviornment
```

#### Install requirements.txt file

```bash
pipenv install -r requirements.txt
```

#### Create requirements.txt file

```
pipenv lock -r > requirements.txt
```

#### Install dev only package, e.g pytest

```bash
pipenv install pytest --dev
```

#### Uninstal package

```
pipenv uninstall requests
```

#### Recreate enviornment with different version of python

Modify python version in the Pipfile

```
pipenv --python 3.6
```

#### Remove virtual enviornment

Only remove enviornment, does not delete Pipfile

```
pipenv --rm
```

#### Create enviornment from Pipfile

```
pipenv install
```

#### Get path to virtual enviornment

```
pipenv --venv
```

#### Check for security vulnerabilities

```
pipenv check
```

#### View installed packages and dependencies

```
pipenv graph
```

#### Update Pipfile.lock

```
pipenv lock
```

#### Create enviornment using Pipfile.lock

```
pipenv install --ignore-pipfile
```

#### Enviornment Variables

```python
touch .env
echo 'SECRET_KEY="secret_key"'
pipenv run python
>>> import os
>>> os.environ['SECRET_KEY']
'MySecretKey'
```

